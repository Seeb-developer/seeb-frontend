# --- React/Vite SPA on Apache: .htaccess ---

# If your app is in a subfolder, set this to that path, e.g. /myapp/
# and also change the SPA fallback below to /myapp/index.html
# Enable Rewrite
RewriteEngine On
RewriteBase /

# ✅ Allow existing files and directories to load normally
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# ✅ Redirect everything else to index.html (SPA fallback)
# This ensures refresh or opening in new tab works on client routes like /policies/terms
RewriteRule . /index.html [L]

# --- Extra Best Practices ---

# Cache busting for Vite hashed assets
<IfModule mod_headers.c>
  <FilesMatch "\.(js|mjs|css|json|png|jpg|jpeg|gif|svg|ico|webp|woff2?|ttf|eot|otf|wasm)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

  <Files "index.html">
    Header set Cache-Control "no-store"
  </Files>
</IfModule>

# 2) SPA fallback: send everything else to index.html
#    This fixes refresh + open-in-new-tab on client routes.
RewriteRule . /index.html [L]

# 3) Caching: long cache for static assets (hashed filenames from Vite)
<IfModule mod_headers.c>
  <FilesMatch "\.(css|js|mjs|png|jpg|jpeg|gif|svg|webp|ico|woff2?|ttf|eot|otf|json|wasm)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

  # Never cache the entry HTML
  <Files "index.html">
    Header set Cache-Control "no-store"
  </Files>
</IfModule>

# 4) CORS for fonts/wasm (prevents blocked fonts when HTML is on a different origin)
<IfModule mod_headers.c>
  <FilesMatch "\.(woff2?|ttf|eot|otf|wasm)$">
    Header set Access-Control-Allow-Origin "*"
  </FilesMatch>
</IfModule>

# 5) (Optional) Compression — safe to include; only works if modules exist
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/css application/javascript application/json image/svg+xml
</IfModule>
<IfModule mod_brotli.c>
  BrotliCompressionQuality 5
  AddOutputFilterByType BROTLI_COMPRESS text/html text/plain text/css application/javascript application/json image/svg+xml
</IfModule>

# 6) (Optional) Security niceties
<IfModule mod_headers.c>
  Header set X-Content-Type-Options "nosniff"
  Header set X-Frame-Options "SAMEORIGIN"
  Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>
Options -Indexes
